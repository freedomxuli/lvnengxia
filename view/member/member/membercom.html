
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Jado绿能侠</title>
        <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
	    <link rel="stylesheet" type="text/css" href="../../../css/mui.min.css" />
	    <link rel="stylesheet" type="text/css" href="../../../css/mui.picker.min.css" />
	    <link rel="stylesheet" type="text/css" href="../../..//css/mui.poppicker.css" />
	    <link rel="stylesheet" type="text/css" href="../../../css/icons-extra.css" />
	    <link rel="stylesheet" type="text/css" href="../../../css/mui.yh.css" />
	    <link rel="stylesheet" type="text/css" href="../../../css/cropper.min.css" />
        
        <style>
        .mui-header{min-height: 35px;}
        .mui-content-avatar{width:100%;height:140px; background-color: #fff;text-align: center}
        .mui-table-view-cell>a{font-size:15px;}
        .mui-icon-arrowright{float:right;}
        .mui-btn-success{width:90%;}
        .zhuxiao-content{margin-top:10px;margin-bottom:10px; background-color:#EDF9F5;height:44px;line-height: 44px;text-align:center;border-bottom:1px #ddd solid;border-top:1px #ddd solid;}
        .zhuxiao-content a{color:#444;position:relative;font-size: 14px;display: inline-block;width: 100%;height: 44px;line-height: 44px;}
        .box-check-group{float: left;width: 50%;line-height: 40px;}
        .box-check-group input[type='radio']{padding: 10px;position: relative;width: 20px;height: 15px;border:1px solid #a1a1a1; border-radius: 50%;background: #efefef;margin-left: 10px;}

        .mui-input-row .extra {
            position: absolute;
            right: -8px;
            top: 2px;
            width: 117px;
            height: 30px;
        }
        .mui-input-row .get-code {
            display: block;
            width: 92px;
            height: 30px;
            border: 0;
            background: #dfe2e5;
            color: #565656;
            cursor: pointer;
        }
        .mui-input-btn-label input[type='text']{width: 45% !important;float: left !important;}
        .mui-input-btn-label button{width: 15% !important;padding: 8px !important;margin:0px !important;}
        #up-avatar{margin-top:20px; width: 20%;height: 50%;border-radius:100px}
        #head_photo{
            width: 40%;
            height: 110px;
            position: absolute;
            z-index: 9;
            opacity: 0;
            left: 30%;
            top:40px;
        }
        .up-image{
            width: 100%;
            height: 28px;
            _width: 100%;
            _height: 28px;
            position: absolute;
            z-index: 9;
            opacity: 0;
            margin-top: 6px;
            left:90px;
        }

        .image-btn-box{position: relative;display: inline-block;width: 100%;}
        .up-image-btn{color: red;}
        .mui-table-view-cell.mui-collapse .mui-collapse-content{padding: 4px 15px;}
        .border{border-top:1px #ddd dotted;}
        .mui-collapse-content h5{color: #333;}
        .mui-button-row{padding-top:2px;}
        </style>
        
    </head>
    <body>
        <header class="mui-bar mui-bar-nav">
            <a class="mui-action-home mui-icon mui-icon-arrowthinleft"></a>
            <h1 class="mui-title">会员中心</h1>
        </header>
        <div class="mui-content">
            <div class="mui-content-avatar">
                <div class="mui-collapse-content">
                    <form>
                         <a href="#sheet"><img src="" alt="头像" id="up-avatar" title="点击修改头像"/>
                        <input type="hidden" name="head_photo" id="head_photo" value="">
                        <input type="hidden" name="photo_pic" id="photo_pic" value="">
                        </a>
                    </form>
                    <p style="margin-top:5px">点击修改头像</p>
                </div>
            </div>
            <!-- 手拉琴 -->
            <ul class="mui-table-view mui-grid-row" style="margin-top: 8px;">
                <li class="mui-table-view-cell mui-collapse mui-active">
                    <a class="mui-navigate-right" href="#">
                        <img src="../../../img/member/grxx.png" class="icon-style" style="width:17px">
                        <span class="span-style">个人信息</span>
                    </a>
                    <div id="account" class="mui-collapse-content">
                        <h5>用户名：</h5>
                    </div>
                    <div id="name" class="mui-collapse-content border">
                        <h5>姓　名：</h5>
                    </div>
                    <div id="addr" class="mui-collapse-content border">
                        <h5>地　址：</h5>
                    </div>
                    <div id="regType" class="mui-collapse-content border">
                        <h5>类　型：</h5>
                    </div>
                    <div id="level" class="mui-collapse-content border">
                        <h5>等　级：</h5>
                    </div>
                    <div class="mui-collapse-content border">
                    	<a class="hyjfrz" href="javascript:void(0);">
	                        <h5>总积分：<span style="color:#F79652" id="point">0</span>
		                        <span class="mui-icon mui-icon-arrowright"></span>
	                        </h5>
	                    </a>
                    </div>
                    <div id="compName" class="mui-collapse-content border">
                        <h5>公司名称：</h5>
                    </div>
                    <div id="fr" class="mui-collapse-content border">
                        <h5>法　人：</h5>
                    </div>
                    <div id="fcmj" class="mui-collapse-content border">
                        <h5>房产面积：</h5>
                    </div>
                    <div id="byqrl" class="mui-collapse-content border">
                        <h5>变压器容量：</h5>
                    </div>
                    <div id="isProCard" class="mui-collapse-content border">
                        <h5>是否有房产证：</h5>
                    </div>
                    <div id="isLandCard" class="mui-collapse-content border">
                        <h5>是否有土地证：</h5>
                    </div>
                    <div id="wdlx" class="mui-collapse-content border">
                        <h5>屋顶类型：</h5>
                    </div>
                    <div class="mui-collapse-content border">
                    	<a class="wdyqm" href="javascript:void(0);">
	                        <h5>我的邀请码：<span style="color:#F79652" id="wdyqm"></span>
		                        <span class="mui-icon mui-icon-arrowright"></span>
	                        </h5>
	                    </a>
                    </div>
                    <div class="mui-collapse-content border">
                    	<a class="wtjdhy" href="javascript:void(0);">
	                        <h5>我推荐的会员：<span style="color:#F79652" id="submember">0</span>
	                        	<span class="mui-icon mui-icon-arrowright"></span>
	                        </h5>
	                    </a>
                    </div>
                    <div class="mui-collapse-content border">
                    	<a class="znx" href="javascript:void(0);">
	                        <h5>站内信：                        <span class="mui-icon mui-icon-arrowright" style="padding-top:3px" id="mail"></span>
	                        	
	                        </h5>
	                    </a>
                    </div>
                </li>
                <li class="mui-table-view-cell mui-collapse">
                    <a class="mui-navigate-right" href="#">
                        <img src="../../../img/member/wsxx.png" class="icon-style" style="width:15px">
                        <span class="span-style">完善信息</span>
                    </a>
                    <div class="mui-collapse-content">
                        <form class="mui-input-group">
                            <input id='inputToken' type="hidden" value="1841017fc608adb5bfcac61d1057241a">
                            <div class="mui-input-row">
                                <label>姓名</label>
                                <input type="text" class="mui-input-clear" placeholder="姓名" name="realName" id="realName" value="英航工作室">
                            </div>
                            <div class="mui-input-row">
                                <label>法人</label>
                                <input type="text" class="mui-input-clear" placeholder="法人" name="corporation" id="corporation" value="">
                            </div>
                            <div class="mui-input-row">
                                <label>房产面积</label>
                                <input type="text" class="mui-input-clear" placeholder="房产面积" name="acreage" id="acreage" value="">
                            </div>
                            <div class="mui-input-row">
                                <label>变压器容量</label>
                                <input type="text" class="mui-input-clear" placeholder="变压器容量" name="rongliang" id="rongliang" value="">
                            </div>
                            <div class="mui-input-row">
                                <label>持有房产证</label>
                                <div class="box-check-group">
                                    <input type="radio" name='isProCard' value="0">否
                                    <input type="radio" name='isProCard' value="1" >是
                                </div>
                            </div>
                            <div class="mui-input-row">
                                <label>持有土地证</label>
                                <div class="box-check-group">
                                    <input type="radio" name='isLandCard' value="0">否
                                    <input type="radio" name='isLandCard' value="1" >是
                                </div>
                            </div>
                            <div class="mui-input-row mui-input-btn-label">
                                <label>屋顶结构</label>
                                <input type="text" name="roofName" id="roofName" placeholder="屋顶结构" value="" readonly>
                                <button data-select='' class="mui-btn mui-btn-block btn-select" id="roofselect" type='button'><i class="mui-icon mui-icon-arrowdown"></i></button>
                                <input class="select-hide" type="hidden" id='roofId' name = 'roofId' value="">
                            </div>
                            <!-- <div class="mui-input-row mui-input-btn-label display display-none">
                                <label>屋顶类型</label>
                                <input type="text" name="kind" placeholder="屋顶类型" value="" readonly>
                                <button data-select='null' class="mui-btn mui-btn-block btn-select" type='button'><i class="mui-icon mui-icon-arrowdown"></i></button>
                                <input class="select-hide" type="hidden" >
                            </div> -->
                            <div class="mui-input-row">
                                <label>详细地址</label>
                                <input type="text" name="addr" id="area" class="mui-input-clear mui-input" placeholder="详细地址" value="测试">
                            </div>
                            <div class="mui-button-row">
                                <button class="mui-btn mui-btn-success" type="submit" id="sub">确定并保存</button>
                            </div>
                        </form>
                    </div>
                </li>
                <li class="mui-table-view-cell mui-collapse">
                    <a class="mui-navigate-right" href="#">
                        <img src="../../../img/member/ghsjh.png" class="icon-style" style="width:14px;top:11px">
                        <span class="span-style">更换手机号</span>
                    </a>
                    <div class="mui-collapse-content">
                        <form class="mui-input-group">
                            <div class="mui-input-row">
                                <label>新手机号</label>
                                <input type="number" class="mui-input-clear" placeholder="输入新手机号" id="newphone" name="newphone">
                            </div>
                            <div class="mui-input-row">
                                <label>验证码</label>
                                <input id="msgCode" type="text" name="msgCode" class="text msgCode" placeholder="短信验证码" >
                                <div class="extra">
                                    <button id="sendBtn" class="msgCodeBtn get-code" type="button" style="display: block;">获取验证码
                                    </button>
                                    <button id="resetTimeBtn" class="msgCodeBtn get-code" disabled style="display: none;">
                                        <span id="resetTime-mobile">60</span>秒后重发
                                    </button>
                                </div>
                                <p class="fill-info"></p>
                            </div>
                            <div class="mui-button-row">
                                <button class="mui-btn mui-btn-success" type="submit" id="changetel">确定并保存</button>
                            </div>
                        </form>
                    </div>
                </li>
                <li class="mui-table-view-cell mui-collapse">
                    <a class="mui-navigate-right" href="#">
                        <img src="../../../img/member/xgmm.png" class="icon-style">
                        <span class="span-style">修改密码</span>
                    </a>
                    <div class="mui-collapse-content">
                        <form class="mui-input-group">
                            <div class="mui-input-row" >
                                <label>新密码</label>
                                <input type="password" class="mui-input-clear" style="font-size:15px" placeholder="输入新密码" id="passwd" name="passwd">
                            </div>
                            <div class="mui-input-row">
                                <label>确认新密码</label>
                                <input type="password" class="mui-input-clear" placeholder="确认新密码" id="repasswd" name="repasswd">
                            </div>
                            <div class="mui-button-row">
                                <button class="mui-btn mui-btn-success" type="submit" id="changepwd">确定并保存</button>
                            </div>
                        </form>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <div class="zhuxiao-content">
        <div class="logout goto-a">退出登录</div>
    </div>
    <div id="sheet" class="mui-popover mui-popover-action mui-popover-bottom" style="display: none;">
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <div class="paizhao image-btn-box">
                    <input type="file" capture="camera" accept="image/*" name="head_photo1" id="head_photo1" value="" class="up-image action-camera">
                    <input type="hidden" name="photo_pic1" id="photo_pic1" value="">
                    <span class="up-image-btn">拍照</span>
                </div>
            </li>
            <li class="mui-table-view-cell">
                <div class="select-file image-btn-box">
                    <input type="file" capture="camera" accept="image/*;capture=camera" name="head_photo2" id="head_photo2" value="" class="up-image action-gallery">
                    <input type="hidden" name="photo_pic2" id="photo_pic2" value="">
                    <span class="up-image-btn-2">相册</span>
                </div>
            </li>
        </ul>
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#sheet" class=""><b>取消</b></a>
            </li>
        </ul>
    </div>
    <!--<div id="sheet" class="mui-popover mui-popover-action mui-popover-bottom"  style="display: none;">
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <div class="paizhao image-btn-box">
                    <input type="file" capture="camera" accept="image/*" name="proCardFile" value="" class="up-image-android action-camera">
                    <span class="proCardFile"></span>
                    <span class="up-image-btn-1">拍照</span>
                </div>
            </li>
            <li class="mui-table-view-cell">
                <div class="select-file image-btn-box">
                    <input type="file" capture="camera" accept="image/*;capture=camera" name="proCardFile" value="" class="up-image-android action-gallery">
                    <span class="proCardFile"></span>
                    <span class="up-image-btn-2">相册</span>
                </div>
            </li>
        </ul>
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#sheet" class=""><b>取消</b></a>
            </li>
        </ul>
    </div>-->
    
	<script src="../../../js/mui.min.js"></script>
	<script src="../../../js/zepto.js"></script>
	<script src="../../../js/mui.picker.js"></script>
	<script src="../../../js/mui.picker.min.js"></script>
	<script src="../../../js/mui.poppicker.js"></script>
	<script src="../../../js/mui.enterfocus.js"></script>
	<script src="../../../js/template.min.js"></script>
	<script src="../../../config.js"></script>
	<script src="../../../js/app.js"></script>
	<script src="../../../js/sign.js"></script>
	<script src="../../../js/md5.js"></script>
	<script src="../../../js/app.min.js"></script>
	<script src="../../../js/jquery.1.9.1.js"></script>
	<script src="../../../js/cropper.min.js"></script>
	<script src="../../../js/exif.js"></script>
	<script type="text/javascript">
	    var jQuery = jQuery.noConflict();
	</script>

    <script type="text/javascript">
        //var homePage = 'http://crm.lvnengxia.cn/index.php?controller=WXApp&action=index';
        //var info = {"id":"1555","parentId":"0","account":"18912303195","realName":"\u82f1\u822a\u5de5\u4f5c\u5ba4","passwd":"7131aa53debf609b88e2268da3a61430","regTime":"2018-05-13","dt":"1526195456","lastLoginTime":"2018-05-18","loginCnt":"3","address":"\u6c5f\u82cf\u7701\u5e38\u5dde\u5e02\u949f\u697c\u533a\u8377\u82b1\u6c60\u8857\u9053\u6d4b\u8bd5","area_id":"10808,11245,11254,11260","regType":"1","memberKind":"","memo":"","remark":"","compName":"18912303195","corporation":"","acreage":null,"rongliang":null,"isProCard":"\u5426","isLandCard":"\u5426","kind":"","age":"","roofAcreage":"","tileKind":"","openId":null,"avatar":"http:\/\/thirdwx.qlogo.cn\/mmopen\/vi_32\/DYAIOgq83eoDXm8XZmVSqhQk7q6vvqMQ4ZibcrDvXhQMbibSIGLBKHukV9c1aS4ZgOnh1rrfDiaAo8t5K2GVIe6Lg\/132","point":"0","experience":"0","appCode":"1805131555","appType":"0","money":"0.00","roofId":"0","relevance":"73","releAgent":"0","ip":"222.188.149.179","timeshopupdate":"0","addr":"\u6d4b\u8bd5","levelName":"\u521d\u5165\u6c5f\u6e56","sonNum":0,"msgNum":0,"roofName":null};
        //var _urlCode = "http://crm.lvnengxia.cn/index.php?controller=LoginWeixin&action=LoginVcode";
        //var upload_url = "http://crm.lvnengxia.cn/index.php?controller=Jichu_App_Upload&action=index";
        var Crop_url = "headimgedit.html";
        var sid = localStorage.getItem("sid");

        /* 获取验证码倒计时 */
        function getCodeCountDown(sec) {
            var s = sec;
            jQuery('#sendBtn').hide();
            jQuery('#resetTimeBtn').show();
            jQuery('#resetTime-mobile').text(s);
            var timer = setInterval(function () {
                if (s > 1) {
                    s--;
                    jQuery('#resetTime-mobile').text(s);
                }
                else {
                    jQuery('#sendBtn').show();
                    jQuery('#resetTimeBtn').hide();
                    clearInterval(timer);
                }
            }, 1000)
        }

        mui.init({
            swipeBack:true //启用右滑关闭功能
        });
        
        mui.plusReady(function(){
        	loadData();
        	loadkind();
        	
        	function loadData(){
        		var waiting = plus.nativeUI.showWaiting();
        		var obj_member = {};
				obj_member["sid"] = sid;
				obj_member["type"] = 'detailed';
				var sign = GetSign(obj_member);
				var param = {
			        queryData: {
			          'method': config.apimethod.member,
			          'sign':sign,
			          'sid':sid,
			          'type':'detailed'
			        },
			        method: 'POST'
			   }
			   $.dataRequest(param, function(rs) {
			   		waiting.close();
			   		if(rs.rsp=="succ")
			        {
			        	jQuery("#up-avatar").attr('src',rs.data.headimgurl);
			        	jQuery("#account").html("<h5>用户名："+rs.data.account+"</h5>");
			        	jQuery("#name").html("<h5>姓　名："+rs.data.name+"</h5>");
			        	jQuery("#addr").html("<h5>地　址："+rs.data.addr+"</h5>");
			        	jQuery("#level").html("<h5>等　级："+rs.data.level+"</h5>");
			        	jQuery("#point").html(rs.data.point);
			        	if(rs.data.regType=="0")
			        		jQuery("#regType").html("<h5>类　型：个人</h5>");
			        	else
			        		jQuery("#regType").html("<h5>类　型：企业</h5>");
			        	/*jQuery("#mail").html(rs.data.mail);*/
			        	jQuery("#area").val(rs.data.area);
			        	jQuery("#roofName").val(rs.data.roof);
			        	jQuery("#roofId").val(rs.data.roofId);
			        	jQuery("#submember").html(rs.data.submember);
			        	jQuery("#compName").html("<h5>公司名称："+rs.data.compName+"</h5>");
			        	jQuery("#fr").html("<h5>法　人："+rs.data.corporation+"</h5>");
			        	jQuery("#fcmj").html("<h5>房产面积："+rs.data.acreage+"</h5>");
			        	jQuery("#byqrl").html("<h5>变压器容量："+rs.data.rongliang+"</h5>");
			        	jQuery("#wdlx").html("<h5>屋顶类型："+rs.data.roof+"</h5>");
			        	jQuery("#corporation").val(rs.data.corporation);
			        	jQuery("#acreage").val(rs.data.acreage);
			        	jQuery("#rongliang").val(rs.data.rongliang);
			        	$("input[name='isProCard']").eq(rs.data.isProCard).attr("checked", "checked");
			        	$("input[name='isLandCard']").eq(rs.data.isLandCard).attr("checked", "checked");
			        	if(rs.data.isProCard=="0"){
			        		jQuery("#isProCard").html("<h5>是否有房产证：否</h5>");
			        	}else
			        	{
			        		jQuery("#isProCard").html("<h5>是否有房产证：是</h5>");
			        	}
			        	if(rs.data.isLandCard=="0"){
			        		jQuery("#isLandCard").html("<h5>是否有土地证：否</h5>");
			        	}else
			        	{
			        		jQuery("#isLandCard").html("<h5>是否有土地证：是</h5>");
			        	}
			        }else
			        {
			        	plus.nativeUI.toast("获取个人信息失败：" + rs.data);
						return;
			        }
			   })
        	}
        	
        	function loadkind(){
        		var obj_roof = {};
        		obj_roof["sid"] = sid;
        		var sign = GetSign(obj_roof);
				var param = {
			        queryData: {
			          'method': config.apimethod.roofget,
			          'sign':sign,
			          'sid':sid
			        },
			        method: 'POST'
			    }
				$.dataRequest(param, function(rs) {
					if(rs.rsp=="succ")
			        {
			        	console.log(JSON.stringify(rs.data));
			        	jQuery("#roofselect").data("select",rs.data);
			        	//选择类型
				        jQuery('.btn-select').each(function(){
				            var picker = new mui.PopPicker();
				            var json = jQuery(this).data('select'); 
				            picker.setData(json);
				            var forInput = jQuery(this).siblings('input[type=text]');
				            var forVal = jQuery(this).siblings('input[type=hidden]');
				            if(forVal.val()){
				                picker.pickers[0].setSelectedValue(forVal.val(), 2000);
				            }
				            this.addEventListener('tap', function(event) {
				                picker.show(function(items) {
				                    forInput && forInput.val(items[0]['text']);
				                    forVal && forVal.val(items[0]['value']);
				                    forVal.change();
				                });
				            }, false);
				        });
			        }
				})
        	}
        	
        	mui(document.body).on('tap','#sendBtn',function(){
		    	var waiting = plus.nativeUI.showWaiting();
		    	var that = this;
		        var phonenum = jQuery('#newphone').val();
		        var inputToken = jQuery('#inputToken').val();
		        if (!phonenum) {
					mui.toast('请先填写新手机号');
					waiting.close();
					return;
				}
		        var val_obj = {};
				val_obj["type"] = "changeTel";
				val_obj["mobile"] = phonenum;
				val_obj["timestamp"] = new Date().getTime();
				console.log(val_obj); 
				var sign = GetSign(val_obj);
				console.log(sign);
				var param = {
			        queryData: {
			          'method': config.apimethod.usersendSms,
			          'sign':sign,
			          'type':"changeTel",
			          'mobile':phonenum,
			          'timestamp':val_obj["timestamp"]
			        },
			        method: 'POST'
			    }
				$.dataRequest(param, function(rs) {
			        console.log(JSON.stringify(rs));
			        waiting.close(); 
			        if(rs.rsp=="succ")
			        {
			        	if(rs.data.success=="true"){
			        		plus.nativeUI.toast("发送成功");
							return;
			        	}else
			        	{
			        		plus.nativeUI.toast("发送失败：" + rs.data.message);
							return;
			        	}
			        }else
			        {
			        	plus.nativeUI.toast("发送失败：" + rs.data);
						return;
			        }
			    });
		    });
		    
		    mui(document.body).on('tap','#changetel',function(){
		    	var waiting = plus.nativeUI.showWaiting();
		    	var phonenum = jQuery('#newphone').val();
		    	var msgCode = jQuery('#msgCode').val();
		        if (!phonenum) {
					mui.toast('请先填写新手机号');
					waiting.close();
					return;
				}
		    	var obj_changetel = {};
		    	obj_changetel["sid"] = sid;
		    	obj_changetel["phone"] = phonenum;
		    	obj_changetel["msgCode"] = msgCode;
		    	obj_changetel["timestamp"] = new Date().getTime();
		    	var sign = GetSign(obj_changetel);
		    	var param = {
			        queryData: {
			          'method': config.apimethod.changetel,
			          'sign':sign,
			          'sid':sid,
			          'phone':phonenum,
			          'msgCode':msgCode,
			          'timestamp':obj_changetel["timestamp"]
			        },
			        method: 'POST'
			    }
				$.dataRequest(param, function(rs) {
			        console.log(JSON.stringify(rs));
			        waiting.close(); 
			        if(rs.rsp=="succ")
			        {
			        	if(rs.data.success=="true"){
			        		plus.nativeUI.toast("修改成功");
							return;
			        	}else
			        	{
			        		plus.nativeUI.toast("修改失败：" + rs.data.msg);
							return;
			        	}
			        }else
			        {
			        	plus.nativeUI.toast("修改失败：" + rs.data);
						return;
			        }
			    });
		    	
		    });
		    
		    mui(document.body).on('tap','#changepwd',function(){
		    	var waiting = plus.nativeUI.showWaiting();
                var passwd = document.getElementById('passwd').value;
                var repasswd = document.getElementById('repasswd').value;
				if (!passwd) {
					mui.toast('请先填写新密码');
					waiting.close();
					return;
				}
				if (!repasswd) {
					mui.toast('请先填写确认新密码');
					waiting.close();
					return;
				}
				if (passwd != repasswd) {
					mui.toast('密码不一致');
					waiting.close();
					return;
				}
		    	var obj_changepwd = {};
		    	obj_changepwd["sid"] = sid;
		    	obj_changepwd["password"] = repasswd;
		    	var sign = GetSign(obj_changepwd);
		    	var param = {
			        queryData: {
			          'method': config.apimethod.changepwd,
			          'sign':sign,
			          'sid':sid,
			          'password':repasswd
			        },
			        method: 'POST'
			    }
				$.dataRequest(param, function(rs) {
			        console.log(JSON.stringify(rs));
			        waiting.close(); 
			        if(rs.rsp=="succ")
			        {
			        	if(rs.data.success=="true"){
			        		plus.nativeUI.toast("修改成功");
							return;
			        	}else
			        	{
			        		plus.nativeUI.toast("修改失败：" + rs.data.msg);
							return;
			        	}
			        }else
			        {
			        	plus.nativeUI.toast("修改失败：" + rs.data);
						return;
			        }
			    });
		    });
		    
		    mui(document.body).on('tap','#sub',function(){
		    	var waiting = plus.nativeUI.showWaiting();
                var realName = document.getElementById('realName').value;
                console.log(realName);
                var corporation = document.getElementById('corporation').value;
                console.log(corporation);
                var acreage = document.getElementById('acreage').value;
                console.log(acreage);
                var rongliang = document.getElementById('rongliang').value;
                console.log(rongliang);
                var isProCard = jQuery('input:radio[name="isProCard"]:checked').val();
                console.log(isProCard);
                var isLandCard = jQuery('input:radio[name="isLandCard"]:checked').val();
                console.log(isLandCard);
                var roofId = document.getElementById('roofId').value;
                console.log(roofId);
                var addr = document.getElementById('area').value;
                console.log(addr);
                
				if (!realName) {
					mui.toast('请先填写姓名');
					waiting.close();
					return;
				}
				if (!corporation) {
					mui.toast('请先填写法人');
					waiting.close();
					return;
				}
				if (!acreage) {
					mui.toast('请先填写房产面积');
					waiting.close();
					return;
				}
				if (!rongliang) {
					mui.toast('请先填写变压器容量');
					waiting.close();
					return;
				}
				if (!roofId) {
					mui.toast('请先填写屋顶结构');
					waiting.close();
					return;
				}
				if (!addr) {
					mui.toast('请先填写详细地址');
					waiting.close();
					return;
				}
		    	var obj_save = {};
		    	obj_save["sid"] = sid;
		    	obj_save["corporation"] = corporation;
		    	obj_save["acreage"] = acreage;
		    	obj_save["rongliang"] = rongliang;
		    	obj_save["isProCard"] = isProCard;
		    	obj_save["isLandCard"] = isLandCard;
		    	obj_save["roofId"] = roofId;
		    	obj_save["addr"] = addr;
		    	var sign = GetSign(obj_save);
		    	var param = {
			        queryData: {
			          'method': config.apimethod.savecom,
			          'sign':sign,
			          'sid':sid,
			          'corporation':corporation,
			          'acreage':acreage,
			          'rongliang':rongliang,
			          'isProCard':isProCard,
			          'isLandCard':isLandCard,
			          'roofId':roofId,
			          'addr':addr
			        },
			        method: 'POST'
			    }
				$.dataRequest(param, function(rs) {
			        console.log(JSON.stringify(rs));
			        waiting.close(); 
			        if(rs.rsp=="succ")
			        {
			        	if(rs.data.success=="true"){
			        		plus.nativeUI.toast("保存成功");
							return;
			        	}else
			        	{
			        		plus.nativeUI.toast("保存失败：" + rs.data.msg);
							return;
			        	}
			        }else
			        {
			        	plus.nativeUI.toast("保存失败：" + rs.data);
						return;
			        }
			    });
		    });
		    
		    
	        mui(document.body).on('tap','.mui-action-home',function(){
	            mui.back();
	        });
	         mui(document.body).on('tap','.goto-a',function(){
	        	var sid = localStorage.getItem("sid");
	    		var obj_sid = {};
				obj_sid["sid"] = sid;
				var sign = GetSign(obj_sid);
				var param = {
			        queryData: {
			          'method': config.apimethod.logout,
			          'sign':sign,
			          'sid':sid
			        },
			        method: 'POST'
			    }
				$.dataRequest(param, function(rs) {
					console.log(JSON.stringify(rs));
					if(rs.rsp=="succ")
	        		{
	        			if(rs.data.status="true")
	        			{
	        			  	  localStorage.removeItem("sid");
	        				  var wa = plus.nativeUI.showWaiting();
				              var parent = plus.webview.currentWebview().opener();
				              parent.reload(true);
				              app.setState({});
				              parent.addEventListener('loaded', function() {
				                wa.close()
				                mui.back();
				                setTimeout(function(){
				                  plus.webview.currentWebview().close();
				                },300)
				              });
	        			}
	        		}
				})
	        });
	        mui(document.body).on('tap','.hyjfrz',function(){
	            clicked('_www/view/member/pointlist/pointlist.html',{
					'type': 1
				});
	        });
	        mui(document.body).on('tap','.wdyqm',function(){
	            clicked('_www/view/member/yqhy/yqhy.html',{
					'type': 1
				});
	        });
	        mui(document.body).on('tap','.wtjdhy',function(){
	            clicked('_www/view/member/hylist/hylist.html',{
					'type': 1
				});
	        });
	        
	        mui(document.body).on('tap','.znx',function(){
	            clicked('_www/view/member/znx/znxlist.html',{
					'type': 1
				});
	        });
        	
        	$('.action-camera').on('tap', function() {
				jQuery('#sheet').css('display','none');
                jQuery('.mui-backdrop').css('display','none');

                /*var mask = mui.createMask(function(){
                    mui.toast('图片上传中...');
                });
                mask.show();//显示遮罩*/
                //mui.toast('图片上传中...');
		        var cmr = plus.camera.getCamera();
				
				cmr.captureImage(function(p) {
					plus.io.resolveLocalFileSystemURL(p, function(entry) {
						cutImage(entry.toLocalURL());//裁剪图片，传入绝对地址
						//var name = entry.toLocalURL().substr(entry.toLocalURL().lastIndexOf('/') + 1)
						//appendFile(mask, "photo_pic1", entry.toLocalURL(), name);
					}, function(e) {
						console.log("读取拍照文件错误：" + e.message);
					});
				}, function(e) {
					console.log("失败：" + e.message);
				}, {
					filename: "_doc/camera/",
					index: 1
				});
			});
			
			$('.action-gallery').on('tap', function() {
				jQuery('#sheet').css('display','none');
                jQuery('.mui-backdrop').css('display','none');
				plus.gallery.pick(function(a) {
                    plus.io.resolveLocalFileSystemURL(a, function(entry) { 　　　　　　//entry为图片原目录（相册）流
                        cutImage(entry.toLocalURL());
                    }, function(e) {
                        console.log("读取图片错误：" + e.message);
                    });
                }, function(a) {}, {
					filter: "image"
				})
			});
			
			//裁剪图片
            function cutImage(path) {
                mui.openWindow({
                    url: 'croppercom.html',
                    id: 'cropper',
                    extras: {
                        path: path,
                    },
                    show: {
                        aniShow: 'zoom-fade-in',
                        duration: 800
                    },
                    waiting: {
                        autoShow: true
                    }
                });
            }
            
            //更新用户头像，主要是裁剪页面裁剪完后触发的
            //添加updateHeadImg自定义事件监听
            window.addEventListener('updateHeadImg',function(event){
                //获得事件参数
	            var my_icon = event.detail.img_path;
	            console.log("裁剪后的图片："+my_icon);
              
                var waiting = plus.nativeUI.showWaiting();
				
		        var obj_img_up = {};
		        obj_img_up["from"] = "APP";
		        obj_img_up["keyCode"] = "";
		        obj_img_up["key"] = "HEAD";
		        obj_img_up["imageFiles"] = my_icon;
		        var sign = GetSign(obj_img_up);
		        var param = {
			        queryData: {
			          'method': config.apimethod.imageupload,
			          'sign':sign,
			          'from':"APP",
			          'keyCode':'',
			          'key':"HEAD",
			          'imageFiles':my_icon
			        },
			        method: 'POST'
			    }
		        $.dataRequest(param, function(rs) {
			        if(rs.rsp=="succ")
			        {
			        	if(rs.data.success=="true"){
			        		//mask.close();//关闭遮罩
			        		waiting.close(); 
		                    //inputnew.val(rs.data.bpic);
		                    //jQuery('#'+hiddenid).val(rs.data.bpic);
		                    //jQuery("#up-avatar").attr('src',rs.data.bpicShow);
		                    var obj_head = {};
		                    obj_head["sid"] = sid;
		                    obj_head["imagePath"] = rs.data.bpic;
		                    sign = GetSign(obj_head);
		                    param = {
						        queryData: {
						          'method': config.apimethod.headimgup,
						          'sign':sign,
						          'sid':sid,
						          'imagePath':rs.data.bpic
						        },
						        method: 'POST'
						    }
		                    $.dataRequest(param, function(rs1) {
		                    	if(rs1.rsp=="succ")
			        			{
			        				if(rs1.data.success=="true"){
			        					console.log(rs.data.bpicShow);
			        					jQuery("#up-avatar").attr('src',rs.data.bpicShow);
			        				}else
			        				{
			        					plus.nativeUI.toast("上传失败：" + rs.data.msg);
										return;
			        				}
			        			}else
			        			{
			        				plus.nativeUI.toast("上传失败：" + rs.data);
									return;
			        			}
		                    })
			        	}else
			        	{
			        		plus.nativeUI.toast("上传失败：" + rs.data.msg);
							return;
			        	}
			        }else
			        {
			        	plus.nativeUI.toast("上传失败：" + rs.data);
						return;
			        }
			    });
            });
			
			// 添加文件
			function appendFile(mask, hiddenid, path, imgname) {
				var img = new Image();
				img.src = path; // 传过来的图片路径在这里用。
				var img_id = '';
				img.onload = function() {
					var el = this;
					//生成比例 
					var w = el.width,
						h = el.height;
					if(w > h) {
						var scale = w / h;
						w = 1280 || w;
						h = w / scale;
					} else {
						var scale = h / w;
						h = 1280 || h;
						w = h / scale;
					}
					//生成canvas
					var canvas = document.createElement('canvas');
					var ctx = canvas.getContext('2d');
					if(w > h) {
						$(canvas).attr({
							width: w,
							height: h
						});
						ctx.drawImage(el, 0, 0, w, h);
					} else {
						$(canvas).attr({
							width: h,
							height: w
						});
						ctx.drawImage(el, 0, 0, h, w);
					}
		
					var base64 = canvas.toDataURL('image/jpeg', 1 || 0.8); //1最清晰，越低越模糊。
					upload(mask, hiddenid, path, base64, imgname);
				}
			}
			
			function upload(mask, hiddenid, localPath, base64, imagename) {
				var waiting = plus.nativeUI.showWaiting();
				
		        var obj_img_up = {};
		        obj_img_up["from"] = "APP";
		        obj_img_up["keyCode"] = "";
		        obj_img_up["key"] = "HEAD";
		        obj_img_up["imageFiles"] = base64;
		        var sign = GetSign(obj_img_up);
		        var param = {
			        queryData: {
			          'method': config.apimethod.imageupload,
			          'sign':sign,
			          'from':"APP",
			          'keyCode':'',
			          'key':"HEAD",
			          'imageFiles':base64
			        },
			        method: 'POST'
			    }
		        $.dataRequest(param, function(rs) {
			        if(rs.rsp=="succ")
			        {
			        	if(rs.data.success=="true"){
			        		mask.close();//关闭遮罩
			        		waiting.close(); 
		                    //inputnew.val(rs.data.bpic);
		                    jQuery('#'+hiddenid).val(rs.data.bpic);
		                    
			        	}else
			        	{
			        		plus.nativeUI.toast("上传失败：" + rs.data.msg);
							return;
			        	}
			        }else
			        {
			        	plus.nativeUI.toast("上传失败：" + rs.data);
						return;
			        }
			    });
			}
        });

       
        /*$('.action-camera').on('tap', function() {
			jQuery('#sheet').css('display','none');
            jQuery('.mui-backdrop').css('display','none');

            var mask = mui.createMask(function(){
                mui.toast('图片上传中...');
            });
            mask.show();//显示遮罩
            mui.toast('图片上传中...');
            
	        var cmr = plus.camera.getCamera();
			
			cmr.captureImage(function(p) {
				plus.io.resolveLocalFileSystemURL(p, function(entry) {
					var name = entry.toLocalURL().substr(entry.toLocalURL().lastIndexOf('/') + 1)
					appendFile(mask, "photo_pic1", entry.toLocalURL(), name);
				}, function(e) {
					console.log("读取拍照文件错误：" + e.message);
				});
			}, function(e) {
				console.log("失败：" + e.message);
			}, {
				filename: "_doc/camera/",
				index: 1
			});
		});
		
		// 添加文件
		function appendFile(mask, hiddenid, path, imgname) {
			var img = new Image();
			img.src = path; // 传过来的图片路径在这里用。
			var img_id = '';
			img.onload = function() {
				var el = this;
				//生成比例 
				var w = el.width,
					h = el.height;
				if(w > h) {
					var scale = w / h;
					w = 1280 || w;
					h = w / scale;
				} else {
					var scale = h / w;
					h = 1280 || h;
					w = h / scale;
				}
				//生成canvas
				var canvas = document.createElement('canvas');
				var ctx = canvas.getContext('2d');
				if(w > h) {
					$(canvas).attr({
						width: w,
						height: h
					});
					ctx.drawImage(el, 0, 0, w, h);
				} else {
					$(canvas).attr({
						width: h,
						height: w
					});
					ctx.drawImage(el, 0, 0, h, w);
				}
	
				var base64 = canvas.toDataURL('image/jpeg', 1 || 0.8); //1最清晰，越低越模糊。
				upload(mask, hiddenid, path, base64, imgname);
			}
		}
		
		function upload(mask, hiddenid, localPath, base64, imagename) {
			var waiting = plus.nativeUI.showWaiting();
			
	        var obj_img_up = {};
	        obj_img_up["from"] = "APP";
	        obj_img_up["keyCode"] = "";
	        obj_img_up["key"] = "HEAD";
	        obj_img_up["imageFiles"] = base64;
	        var sign = GetSign(obj_img_up);
	        var param = {
		        queryData: {
		          'method': config.apimethod.imageupload,
		          'sign':sign,
		          'from':"APP",
		          'keyCode':'',
		          'key':"HEAD",
		          'imageFiles':base64
		        },
		        method: 'POST'
		    }
	        $.dataRequest(param, function(rs) {
		        if(rs.rsp=="succ")
		        {
		        	if(rs.data.success=="true"){
		        		mask.close();//关闭遮罩
		        		waiting.close(); 
	                    //inputnew.val(rs.data.bpic);
	                    jQuery('#'+hiddenid).val(rs.data.bpic);
                        t_layer = jQuery.layer({
                            type: 2,
                            shade: [1],
                            fix: false,
                            title: '裁剪头像',
                            iframe: {src : Crop_url+"?img="+rs.data.bpic},
                            area: ['100%' , '100%'],
                            border : [0, 0 , '#000', false],
                            close: function(index){//关闭时触发
                            },
                            callback:function(index,ret) {
                                mui.alert('修改成功',function(){
                                    location.reload();
                                });
                            }
                        });
                    
		        	}else
		        	{
		        		plus.nativeUI.toast("上传失败：" + rs.data.msg);
						return;
		        	}
		        }else
		        {
		        	plus.nativeUI.toast("上传失败：" + rs.data);
					return;
		        }
		    });
		}*/

        //文件上传带预览
        /*function ajaxFileUploadview(imgid,hiddenid,url){
            jQuery('#sheet').css('display','none');
            jQuery('.mui-backdrop').css('display','none');

            var mask = mui.createMask(function(){
                mui.toast('图片上传中...');
            });
            mask.show();//显示遮罩
            mui.toast('图片上传中...');

            jQuery.ajaxFileUpload({
                url:url,
                secureuri:false,
                fileElementId:imgid,
                dataType: 'json',
                data:{name:'logan', id:'id'},

                success: function (data, status)
                {
                    mask.close();//关闭遮罩
                    if(typeof(data.error) != 'undefined')
                    {
                        if(data.error != '')
                        {
                            mui.alert(data.error);

                        }else{
                            var resp = data.msg;
                            if(resp != '0000'){
                                mui.alert(data.error);
                                return false;
                            }else{
                                jQuery('#'+hiddenid).val(data.imgurl);
                                t_layer = jQuery.layer({
                                    type: 2,
                                    shade: [1],
                                    fix: false,
                                    title: '裁剪头像',
                                    iframe: {src : Crop_url+"&img="+data.imgurl},
                                    area: ['100%' , '100%'],
                                    border : [0, 0 , '#000', false],
                                    close: function(index){//关闭时触发
                                    },
                                    callback:function(index,ret) {
                                        mui.alert('修改成功',function(){
                                            location.reload();
                                        });
                                    }
                                });
                            }

                        }
                    }
                },
                error: function (data, status, e)
                {
                    mui.alert('修改失败');
                    mask.close();//关闭遮罩
                }
            })

            return false;
        }*/

        /*function tb_remove(){
            layer.close(t_layer); //执行关闭
        }*/

        
    </script>
</body>

</html>