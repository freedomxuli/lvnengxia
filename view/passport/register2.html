<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <title>Shopex Onex B2B2C</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="../../css/style.css">
    <style type="text/css">
    	.txt-func{
    		color: orange !important;
    	}
    	.space-div{
				height: 10px;
			}
			
			/*内容部分*/
			.center-content-title{
				background-color: #edf9f5;
				padding: 1rem 1rem 0.5rem 1rem;
				display: flex;
				flex-direction: row;
				align-items: center;
			}
			.center-content-title-img-div{
				flex: 1;
			}
			.center-content-title-img{
				width: 1.5rem;
				margin-top:0.2rem ;
			}
			.center-content-title-text-div{
				color: #2AB673;
				font-size: 1rem;
				flex: 2.5;
				font-weight: bold;
			}
			.center-content-title-right{
				flex: 6;
				text-align: right;
			}
			.center-content-title-right-img{
				width: 1.2rem;
			}
			
			.center-content-nr{
				background-color: #FFFFFF;
				padding: 0.8rem 1rem 0.6rem 1rem;
				display: flex;
				flex-direction: row;
				align-items: center;
				border-bottom: 1px solid #CCCCCC;
			}
			.center-content-nr-bottom{
				padding: 1.8rem 1rem 0.6rem 1rem;
				display: flex;
				flex-direction: row;
				align-items: center;
			}
			.center-content-nr-left{
				color: #1f1f1f;
			}
			.center-content-nr-right{
				color: #666666;
			}
			.center-content-nr-right1{
				color: #f69653;
			}
			.center-content-nr-right-img{
				flex: 1;
				text-align: right;
			}
			.center-content-nr-right-img img{
				height: 1rem;
			}
			.center-content-nr-left-2{
				flex: 1.5;
			}
			.center-content-nr-right-2{
				flex: 2;
				color: #666666;
			}
			.center-content-nr-right-input{
				border:none !important;
				height: 2rem !important;
				margin-bottom: 0rem !important;
				padding: 0rem !important;
			}
			.center-content-nr-submit{
				color: #FFFFFF;
				background-color: #2AB673;
				text-align: center;
				flex: 1;
				padding: 0.5rem 0rem 0.5rem 0rem;
				border-radius: 5px;
			}
			.center-content-nr-yzm{
				color: #555555;
				background-color: #CCCCCC;
			}
			.bottom-content-div{
				background-color: #EDF9F5;
				color: #555555;
				text-align: center;
				border-bottom: 1px solid #CCCCCC;
				border-top: 1px solid #CCCCCC;
				padding: 0.5rem 0rem 0.5rem 0rem;
			}
    </style>
  </head>

  <body>
		<header class="page-header">
      <img class="header-img" src="../../img/register/back.png"/>
      <div class="header-title">个人注册</div>
      <div id="cart_edit" class="header-right txt-func">会员注册</div>
    </header>
	    <section class="container">
	    	<div class="center-content-nr">
	    		<div class="center-content-nr-left-2">
	    			手机号
	    		</div>
	    		<div class="center-content-nr-right-2">
	    			<input class="center-content-nr-right-input" type="text" placeholder="请输入手机号" />
	    		</div>
	    		<div class="center-content-nr-right-img">
	    			&nbsp;
	    		</div>
	    	</div>
	    	<div class="center-content-nr">
	    		<div class="center-content-nr-left-2">
	    			姓名
	    		</div>
	    		<div class="center-content-nr-right-2">
	    			<input class="center-content-nr-right-input" type="text" placeholder="请输入姓名" />
	    		</div>
	    		<div class="center-content-nr-right-img">
	    			&nbsp;
	    		</div>
	    	</div>
	    	<div class="center-content-nr">
	    		<div class="center-content-nr-left-2">
	    			密码
	    		</div>
	    		<div class="center-content-nr-right-2">
	    			<input class="center-content-nr-right-input" type="text" placeholder="请输入密码" />
	    		</div>
	    		<div class="center-content-nr-right-img">
	    			&nbsp;
	    		</div>
	    	</div>
	    	<div class="center-content-nr">
	    		<div class="center-content-nr-left-2">
	    			确认密码
	    		</div>
	    		<div class="center-content-nr-right-2">
	    			<input class="center-content-nr-right-input" type="text" placeholder="请确认密码" />
	    		</div>
	    		<div class="center-content-nr-right-img">
	    			&nbsp;
	    		</div>
	    	</div>
	    	<div class="center-content-nr">
	    		<div class="center-content-nr-left-2">
	    			省
	    		</div>
	    		<div class="center-content-nr-right-2">
	    			江苏省
	    		</div>
	    		<div class="center-content-nr-right-img">
	    			<img src="../../img/member/next.png" />
	    		</div>
	    	</div>
	    	<div class="center-content-nr">
	    		<div class="center-content-nr-left-2">
	    			市
	    		</div>
	    		<div class="center-content-nr-right-2">
	    			常州市
	    		</div>
	    		<div class="center-content-nr-right-img">
	    			<img src="../../img/member/next.png" />
	    		</div>
	    	</div>
	    	<div class="center-content-nr">
	    		<div class="center-content-nr-left-2">
	    			区
	    		</div>
	    		<div class="center-content-nr-right-2">
	    			钟楼区
	    		</div>
	    		<div class="center-content-nr-right-img">
	    			<img src="../../img/member/next.png" />
	    		</div>
	    	</div>
	    	<div class="center-content-nr">
	    		<div class="center-content-nr-left-2">
	    			镇
	    		</div>
	    		<div class="center-content-nr-right-2">
	    			
	    		</div>
	    		<div class="center-content-nr-right-img">
	    			<img src="../../img/member/next.png" />
	    		</div>
	    	</div>
	    	<div class="center-content-nr">
	    		<div class="center-content-nr-left-2">
	    			验证码　
	    		</div>
	    		<div class="center-content-nr-right-2">
	    			<input class="center-content-nr-right-input" type="text" placeholder="短信验证码" />
	    		</div>
	    		<div class="center-content-nr-left-2">
	    			<button class="center-content-nr-yzm">
	    				获取验证码
	    			</button>
	    		</div>
	    	</div>
	    	<div class="center-content-nr-bottom">
	    		<div class="center-content-nr-submit">
	    			确定并保存
	    		</div>
	    	</div>
	  </section>
    <script src="../../js/zepto.js"></script>
    <script src="../../js/mui.min.js"></script>
    <script src="../../js/template.min.js"></script>
    <script src="../../config.js"></script>
    <script src="../../js/app.js"></script>

    <script type="text/html" id="onlymobile">
      <label>手机号：</label>
      <input id="account" type="text" class="mui-input-clear" placeholder="请输入您的手机号">
    </script>

    <script type="text/html" id="multipletype">
      <label>帐号：</label>
      <input id="account" type="text" class="mui-input-clear" placeholder="请输入您的手机号/用户名">
    </script>

    <script>
      mui.plusReady(function() {
        // 判断是否支持多账号类型注册
        checkMultipletypeRegister();

        var entrance = plus.webview.currentWebview().entrance;
        fetchVcode('topapi_register',$('#vcode_img'));
        $('#vcode_img').on('tap', function() {
          fetchVcode('topapi_register',$(this));
        })
        $('#register_next').on('tap', function() {
          var account = $('#account').val();
          var vcode = $('#vcode').val();
          if(!account) {
            mui.alert('用户名或者手机号不能为空');
            return
          }
          if(!vcode) {
            mui.alert('请填写验证码');
            return
          }
          if(!$('input[name="license"]').prop('checked')) {
            mui.alert('请阅读并接受会员注册协议');
            return;
          }
          var param = {
            queryData: {
              'method': config.apimethod.verifyAccount,
              'account': account,
              'vcode_type': 'topapi_register',
              'verifycode': vcode
            },
            method: 'POST'
          }
          $.dataRequest(param, function(rs) {
            var data = rs.data;
            var token = data.verifyAccount_token
            if( data.type === 'login_account' || data.type === 'email') {
              clicked('_www/view/member/safe/logpasswordset.html', {
                'accesstoken': token,
                'account': account,
                'entrance': entrance
              });
            }else if(data.type === 'mobile') {

              sendSms(account,token);

              clicked('_www/view/member/safe/verificationsms.html', {
                'accesstoken': token,
                'mobile': account,
                'actiontype': 'register',
                'signup_token': token,
                'entrance': entrance
              });
            }
          });
        });
      });

      function sendSms(account, token) {
        var param = {
          queryData: {
            'method': config.apimethod.usersendSms,
            'mobile': account,
            'type': 'signup',
            'send_sms_token': token
          },
          method: 'POST'
        }
        $.dataRequest(param, function(rs) {
        });
      }

      // 检查是否只支持手机注册，还是多种方式注册
      function checkMultipletypeRegister(){
          var param = {
            queryData: {
              'method': config.apimethod.getcommonsetting,
              'settingname': 'check_register_multipletype',
            },
            method: 'POST'
          }
          $.dataRequest(param, function(rs) {
            if(rs.data.check_register_multipletype=='1'){
              var temp = 'multipletype';
            }else{
              var temp = 'onlymobile';
            }
            var regisnametemp = template(temp, rs.data);
            $('.register_multipletype').html(regisnametemp);
          });
      }

      document.getElementById('agreement').addEventListener('tap', function() {
        clicked('_www/view/passport/agreement.html', {}, 'slide-in-bottom');
      });
      
      window.addEventListener('readed',function(event){
        $('input[name="license"]').prop('checked', 'checked');
      });
    </script>
  </body>

</html>
